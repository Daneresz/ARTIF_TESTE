<%- include('../cabecalho.ejs') %>
    <div style="margin-bottom: 16px;">
        <a href="/artes" style="text-decoration: none; color: #007bff; font-weight: bold;">ðŸŽ¨ Ver Artes</a>
    </div>
    <h1>Artistas</h1>
    <form method="get" action="/artista" style="margin-bottom: 16px;">
        <input type="text" name="busca" placeholder="Pesquisar por Artista ou Arte"
            value="<%= typeof busca !== 'undefined' ? busca : '' %>">
        <button type="submit">Buscar</button>
    </form>
    <div class="music-list">
        <% if (Musicas.length===0) { %>
            <p>Nenhuma Artista encontrada.</p>
            <% } else { %>
                <% for (const m of Musicas) { %>
                    <div class="music-item">
                        <div class="music-summary">
                            <h3>
                                <%= m.artista %>
                            </h3>
                            <button type="button" class="expand-btn">Expanda</button>
                        </div>
                        <div class="music-details" style="display:none; margin-top:8px;">
                            <div style="display:flex; gap:16px; align-items:flex-start;">
                                <div>
                                    <% if (m.perfil) { %>
                                        <img src="<%= m.perfil %>" alt="perfil" style="width:120px;height:auto" onerror="this.src='/img/user-placeholder.svg'">
                                        <% } %>
                                </div>
                                <div>
                                    <p><strong>Artes:</strong>
                                        <% if (m.artes && m.artes.length > 0) { %>
                                            <%= m.artes.join(', ') %>
                                        <% } else if (m.arte) { %>
                                            <%= m.arte %>
                                        <% } %>
                                    </p>
                                    <p><strong>Idade:</strong>
                                        <%= m.idade %>
                                    </p>
                                    <% if (m.letra) { %>
                                        <p><strong>Letra:</strong> <br>
                                        <pre style="white-space:pre-wrap"><%= m.letra %></pre>
                                        </p>
                                        <% } %>
                                            <% if (m.cifra) { %>
                                                <details>
                                                    <summary>Mostrar cifra</summary>
                                                    <pre style="white-space:pre-wrap"><%= m.cifra %></pre>
                                                </details>
                                                <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                    <% } %>
                        <% } %>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.music-item').forEach(function (item) {
                var btn = item.querySelector('.expand-btn');
                var details = item.querySelector('.music-details');
                if (!btn || !details) return;
                btn.addEventListener('click', function () {
                    var isHidden = details.style.display === 'none' || details.style.display === '';
                    details.style.display = isHidden ? 'block' : 'none';
                    btn.textContent = isHidden ? 'Fechar' : 'Expanda';
                });
            });
        });
    </script>
    <%- include('../rodape.ejs') %>